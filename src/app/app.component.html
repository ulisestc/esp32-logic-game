<div class="modal-overlay" *ngIf="showModal">
  <div class="modal-content">
    <h2>¡Reto {{ current_challenge }} Completado!</h2>
    <button (click)="advanceToNextLevel()">Siguiente Nivel</button>
  </div>
</div>

<div class="app-container">
  
  <div class="card connection-frame">
    <h3>Conexión</h3>
    <div class="ip-group">
      <label for="ip">IP del ESP32:</label>
      <input 
        id="ip" 
        type="text" 
        [(ngModel)]="esp32_ip" 
        [disabled]="is_polling">
      <button (click)="startPolling()" [disabled]="is_polling">
        {{ is_polling ? 'Conectado' : 'Conectar' }}
      </button>
    </div>
    <div class="status">
      Estado: 
      <span [ngClass]="is_connected ? 'connected' : 'disconnected'">
        {{ is_connected ? 'Conectado' : 'Desconectado' }}
      </span>
    </div>
  </div>

<div class="card challenge-frame" *ngIf="current_challenge <= 6">
    <h2>{{ challenges[current_challenge].nombre }}</h2>
    <p class="instruction">{{ challenges[current_challenge].instruccion }}</p>
    
    <blockquote class="explanation">
      <strong>¿Cómo funciona?</strong>
      <p>{{ challenges[current_challenge].explicacion }}</p>
      <img class="truth-table" *ngIf="challenges[current_challenge].truth_table_img" [src]="challenges[current_challenge].truth_table_img" alt="Tabla de verdad" />
    </blockquote>

  </div>
  
  <div class="card challenge-frame" *ngIf="current_challenge > 6">
    <h2 class="victory">{{ challenges[7].nombre }}</h2>
    <p class="instruction">{{ challenges[7].instruccion }}</p>
  </div>


  <div class="card status-frame">
    
    <div class="inputs">
      <h4>ENTRADAS (Físicas)</h4>
      <div 
        class="button-status" 
        [class.on]="button_states.boton_a">
        BOTÓN A: {{ button_states.boton_a ? 'ON' : 'OFF' }}
      </div>
      <div 
        class="button-status" 
        [class.on]="button_states.boton_b">
        BOTÓN B: {{ button_states.boton_b ? 'ON' : 'OFF' }}
      </div>
      <div 
        class="button-status" 
        [class.on]="button_states.boton_c">
        BOTÓN C: {{ button_states.boton_c ? 'ON' : 'OFF' }}
      </div>
    </div>
    
    <div class="divider"></div>

    <div class="output">
      <h4>SALIDA (Lógica)</h4>
      <div 
        class="led-virtual" 
        [class.on]="current_led_output">
        LED: {{ current_led_output ? 'ON' : 'OFF' }}
      </div>
      <div class="led-expected" *ngIf="current_challenge <= 6">
        Resultado esperado: {{ challenges[current_challenge].led_esperado }}
      </div>
    </div>
  </div>

  <div class="card progress-frame">
    <h4>Progreso (GUI)</h4>
    <div class="progress-bar">
      <div 
        *ngFor="let _ of [0, 0, 0, 0, 0, 0]; let i = index" 
        class="progress-led"
        [class.on]="i < (current_challenge - 1)">
        {{ (i < (current_challenge - 1)) ? 'X' : 'O' }}
      </div>
    </div>
  </div>

</div>